
# Exercise 08 — Актуализация UC
# UC02: Сформировать расписание мастера

## Общая информация

- **Контекст использования:** Менеджер создает расписание работы мастера в виде слотов, доступных для записи клиентов.
- **Область действия:** Барбершоп, оказание услуг клиентам.
- **Уровень:** Цель пользователя.
- **Основное действующее лицо:** Менеджер.
- **Предусловия:**
  - Менеджер получил график работы мастеров (офлайн или из другой системы).
  - Менеджер зашел на веб-приложение барбершопа через браузер.

---

## Основной сценарий

| № | Действие | Приложение/Сервис | Роль | Интеграционные методы |
|--:|----------|--------------------|------|------------------------|
| 1 | Менеджер открывает страницу ввода слотов | Клиент (веб-интерфейс) | Менеджер | — |
| 2 | Менеджер выбирает дату, время (начало слота), мастера из справочника «Сотрудники», отфильтрованного по роли «Мастер» | Клиент → Сервер | Менеджер | `GET /api/employees?role=master` |
| 3 | Система проверяет, не забронирован ли выбранный слот | Сервер → Сервис слотов | Система | `GET /api/slots/check-availability?date=...&time=...&masterId=...` |
| 4 | Менеджер подтверждает создание слота | Клиент | Менеджер | — |
| 5 | Система закрепляет слот (дата, время, мастер) | Сервер → Сервис слотов | Система | `POST /api/slots` |

---

## Альтернативный сценарий (слот уже забронирован)

| № | Действие | Приложение/Сервис | Роль | Интеграционные методы |
|--:|----------|--------------------|------|------------------------|
| 3a | Система сообщает, что слот уже забронирован клиентом | Сервер | Система | — |
| 3b | Менеджер связывается с клиентом по телефону и договаривается о переносе | Вне системы (ручной шаг) | Менеджер | — |
| 3c | Менеджер вносит новое время / мастера в систему вручную | Клиент → Сервер | Менеджер | — |
| 3d | Система обновляет слот и уведомляет клиента по СМС | Сервер → Сервис уведомлений | Система | `POST /api/sms/send` |

---

## Примечания

- **Справочник сотрудников** (роль "Мастер") может быть реализован через фильтрацию по роли.
- **Проверка доступности слота** – обязательно выполняется до подтверждения.
- **Интеграция с СМС-сервисом** должна быть идемпотентной, чтобы избежать дублирующих уведомлений.

---

## Интеграционные методы

| Назначение | Метод | URL |
|------------|--------|-----|
| Получение списка мастеров | `GET` | `/api/employees?role=master` |
| Проверка доступности слота | `GET` | `/api/slots/check-availability` |
| Закрепление слота | `POST` | `/api/slots` |
| Уведомление клиента | `POST` | `/api/sms/send` |


# Exercise 09 — Определение и описание методов  
## UC02 — Сформировать расписание мастера

Контекст: Менеджер создает расписание работы мастера в виде слотов.  
Интеграции происходят при проверке занятости слота и создании нового слота.

---

## Интеграция 1: Проверка занятости слота

**Вопросы — ответы:**
- CRUD-операция: **Read**
- Метод должен быть безопасным? — Да
- Требуется идемпотентность? — Да
- Подходит метод: **GET**

**Метод:**  
`GET /api/slots/check-availability`

**Параметры запроса (query string):**
- `date` — дата слота (в формате YYYY-MM-DD)
- `time` — время начала (в формате HH:mm)
- `masterId` — идентификатор мастера

**Пример запроса:**  

`GET /api/slots/check-availability?date=2025-07-15&time=10:00&masterId=123`


**Успешный ответ:**

**Код:** `200 OK`  
```json
{
  "available": true
}
```

**Ошибочный ответ:**

**Код:** `400 Bad Request`

```json
{
  "error": "Invalid parameters",
  "message": "Missing or invalid date, time, or masterId"
}
```

## Интеграция 2: Создание слота

**Вопросы — ответы:**
- CRUD-операция: **Create**
- Метод должен быть безопасным? — Нет
- Требуется идемпотентность? — Нет
- Подходит метод: **POST**

**Метод:**  
`POST /api/schedule`

**Запрос:**  

```json
{
  "date": "2025-07-15",
  "startTime": "10:00",
  "masterId": "123"
}
```

**Успешный ответ:**

**Код:** `201 Created`  
```json
{
  "message": "Slot successfully created",
  "slotId": "abc123"
}
```

**Ошибочный ответ:**

**Код:** `409 Conflict`

```json
{
  "error": "SlotOccupied",
  "message": "Selected slot is already occupied by a client"
}
```

## Вывод

| Интеграция                  | Метод | URL                             | Идемпотентность | Безопасность |
|----------------------------|--------|----------------------------------|------------------|----------------|
| Проверка занятости слота   | GET    | /api/slots/check-availability    | ✅               | ✅             |
| Создание слота             | POST   | /api/schedule                    | ❌               | ❌             |
